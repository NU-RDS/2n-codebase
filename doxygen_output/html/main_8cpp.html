<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RDS Team 2N: src/main.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">RDS Team 2N
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">main.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Main entry point for the motor control and serial feedback system.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;FlexCAN_T4.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &quot;<a class="el" href="r1806_8h_source.html">motor_protocols/r1806.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="motor__protocols_2utils_8h_source.html">motor_protocols/utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="serial__protocols_8h_source.html">serial_protocols/serial_protocols.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="serial__protocols_2utils_8h_source.html">serial_protocols/utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="finger_8h_source.html">finger/finger.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="controller_8h_source.html">controller/controller.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="main_8cpp__incl.png" border="0" usemap="#asrc_2main_8cpp" alt=""/></div>
<map name="asrc_2main_8cpp" id="asrc_2main_8cpp">
<area shape="rect" title="Main entry point for the motor control and serial feedback system." alt="" coords="361,5,467,31"/>
<area shape="rect" title=" " alt="" coords="5,167,119,192"/>
<area shape="poly" title=" " alt="" coords="361,24,286,29,200,39,124,56,95,67,76,81,66,96,61,115,60,153,55,153,55,114,61,94,72,77,93,62,122,51,200,34,285,23,361,18"/>
<area shape="rect" title=" " alt="" coords="289,167,357,192"/>
<area shape="poly" title=" " alt="" coords="410,32,339,156,334,153,405,29"/>
<area shape="rect" href="r1806_8h.html" title="Motor protocols for the R1806 motor used with ODrive Pro." alt="" coords="86,86,267,111"/>
<area shape="poly" title=" " alt="" coords="380,33,225,84,223,79,379,28"/>
<area shape="rect" href="motor__protocols_2utils_8h.html" title="Contains utility data structures and definitions for motor protocols." alt="" coords="580,86,752,111"/>
<area shape="poly" title=" " alt="" coords="451,28,617,79,615,84,450,33"/>
<area shape="rect" href="serial__protocols_8h.html" title="Declaration of the SerialProtocols class for handling serial communication." alt="" coords="777,79,942,119"/>
<area shape="poly" title=" " alt="" coords="467,25,763,76,762,81,467,30"/>
<area shape="rect" href="serial__protocols_2utils_8h.html" title="Defines constants used in the serial communication protocols." alt="" coords="897,167,1067,192"/>
<area shape="poly" title=" " alt="" coords="467,19,745,38,881,55,929,65,956,77,970,93,978,113,985,153,980,154,973,115,965,96,952,81,927,70,880,60,745,44,467,24"/>
<area shape="rect" href="finger_8h.html" title="Declaration of the Finger class and related constants." alt="" coords="155,167,265,192"/>
<area shape="poly" title=" " alt="" coords="401,33,238,160,234,156,398,29"/>
<area shape="rect" href="controller_8h.html" title="Declaration of the Controller class for torque control." alt="" coords="393,86,555,111"/>
<area shape="poly" title=" " alt="" coords="425,29,459,73,455,76,421,32"/>
<area shape="poly" title=" " alt="" coords="161,114,92,161,89,157,158,109"/>
<area shape="rect" title=" " alt="" coords="773,240,844,265"/>
<area shape="poly" title=" " alt="" coords="702,109,745,131,767,146,785,165,801,195,809,225,804,227,796,197,781,168,763,150,742,135,699,114"/>
<area shape="poly" title=" " alt="" coords="855,120,819,228,814,226,850,118"/>
<area shape="poly" title=" " alt="" coords="890,117,954,157,951,161,888,121"/>
<area shape="poly" title=" " alt="" coords="955,194,851,237,849,232,953,190"/>
<area shape="poly" title=" " alt="" coords="266,188,278,189,550,223,760,244,759,249,550,228,278,195,265,193"/>
<area shape="poly" title=" " alt="" coords="453,114,359,163,356,158,451,109"/>
<area shape="poly" title=" " alt="" coords="460,114,442,130,425,150,417,172,418,181,423,190,445,207,479,220,522,230,571,237,672,246,759,249,759,254,672,251,570,243,521,235,478,225,442,211,419,194,412,183,411,171,420,148,438,126,457,110"/>
<area shape="poly" title=" " alt="" coords="436,114,262,165,261,160,435,109"/>
<area shape="rect" title=" " alt="" coords="433,167,513,192"/>
<area shape="poly" title=" " alt="" coords="476,112,476,153,470,153,471,111"/>
<area shape="rect" title=" " alt="" coords="537,167,600,192"/>
<area shape="poly" title=" " alt="" coords="490,109,546,156,542,160,486,114"/>
<area shape="rect" title=" " alt="" coords="625,167,681,192"/>
<area shape="poly" title=" " alt="" coords="501,109,615,159,613,164,499,114"/>
<area shape="rect" title=" " alt="" coords="705,167,771,192"/>
<area shape="poly" title=" " alt="" coords="513,109,692,162,691,167,512,114"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8b5e6477c003c4cbfb7cf9ba724fce34" id="r_a8b5e6477c003c4cbfb7cf9ba724fce34"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a8b5e6477c003c4cbfb7cf9ba724fce34">canSniff</a> (const CAN_message_t &amp;<a class="el" href="main_8cpp.html#a7b7e0c51c97a7d2837c3aef9953192f1">msg</a>)</td></tr>
<tr class="memdesc:a8b5e6477c003c4cbfb7cf9ba724fce34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function for received CAN messages.  <br /></td></tr>
<tr class="separator:a8b5e6477c003c4cbfb7cf9ba724fce34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4a7316a51b17d0f691bb3e33b95a5ad" id="r_ad4a7316a51b17d0f691bb3e33b95a5ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#ad4a7316a51b17d0f691bb3e33b95a5ad">calibrate</a> ()</td></tr>
<tr class="memdesc:ad4a7316a51b17d0f691bb3e33b95a5ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibrates motor position offsets.  <br /></td></tr>
<tr class="separator:ad4a7316a51b17d0f691bb3e33b95a5ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7dfd9b79bc5a37d7df40207afbc5431f" id="r_a7dfd9b79bc5a37d7df40207afbc5431f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#a7dfd9b79bc5a37d7df40207afbc5431f">setup</a> (void)</td></tr>
<tr class="memdesc:a7dfd9b79bc5a37d7df40207afbc5431f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the system.  <br /></td></tr>
<tr class="separator:a7dfd9b79bc5a37d7df40207afbc5431f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f" id="r_afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="memdesc:afe461d27b9c48d5921c00d521181f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main control loop.  <br /></td></tr>
<tr class="separator:afe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af491bc470adef8b258c75dafed0077b9" id="r_af491bc470adef8b258c75dafed0077b9"><td class="memItemLeft" align="right" valign="top"><a id="af491bc470adef8b258c75dafed0077b9" name="af491bc470adef8b258c75dafed0077b9"></a>
FlexCAN_T4&lt; CAN1, RX_SIZE_256, TX_SIZE_16 &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>can1</b></td></tr>
<tr class="memdesc:af491bc470adef8b258c75dafed0077b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">CAN bus object. <br /></td></tr>
<tr class="separator:af491bc470adef8b258c75dafed0077b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b7e0c51c97a7d2837c3aef9953192f1" id="r_a7b7e0c51c97a7d2837c3aef9953192f1"><td class="memItemLeft" align="right" valign="top"><a id="a7b7e0c51c97a7d2837c3aef9953192f1" name="a7b7e0c51c97a7d2837c3aef9953192f1"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>msg</b></td></tr>
<tr class="memdesc:a7b7e0c51c97a7d2837c3aef9953192f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Temporary CAN message storage. <br /></td></tr>
<tr class="separator:a7b7e0c51c97a7d2837c3aef9953192f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40cbacc0d1c8008497eb1eee2e2b176f" id="r_a40cbacc0d1c8008497eb1eee2e2b176f"><td class="memItemLeft" align="right" valign="top"><a id="a40cbacc0d1c8008497eb1eee2e2b176f" name="a40cbacc0d1c8008497eb1eee2e2b176f"></a>
<a class="el" href="classR1806.html">R1806</a>&#160;</td><td class="memItemRight" valign="bottom"><b>r1806_protocols</b></td></tr>
<tr class="memdesc:a40cbacc0d1c8008497eb1eee2e2b176f"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classR1806.html" title="Provides methods to encode and decode CAN messages for controlling an R1806 motor via ODrive.">R1806</a> motor protocol handler. <br /></td></tr>
<tr class="separator:a40cbacc0d1c8008497eb1eee2e2b176f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c1a12e7433ba7b8e0403a9c8ec115ff" id="r_a6c1a12e7433ba7b8e0403a9c8ec115ff"><td class="memItemLeft" align="right" valign="top"><a id="a6c1a12e7433ba7b8e0403a9c8ec115ff" name="a6c1a12e7433ba7b8e0403a9c8ec115ff"></a>
<a class="el" href="classSerialProtocols.html">SerialProtocols</a>&#160;</td><td class="memItemRight" valign="bottom"><b>serial_protocols</b></td></tr>
<tr class="memdesc:a6c1a12e7433ba7b8e0403a9c8ec115ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serial protocol handler. <br /></td></tr>
<tr class="separator:a6c1a12e7433ba7b8e0403a9c8ec115ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adee0025a48211ddc9040329deb7e2cce" id="r_adee0025a48211ddc9040329deb7e2cce"><td class="memItemLeft" align="right" valign="top"><a id="adee0025a48211ddc9040329deb7e2cce" name="adee0025a48211ddc9040329deb7e2cce"></a>
<a class="el" href="classFinger.html">Finger</a>&#160;</td><td class="memItemRight" valign="bottom"><b>finger</b></td></tr>
<tr class="memdesc:adee0025a48211ddc9040329deb7e2cce"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classFinger.html" title="Provides functionality to convert between motor states and finger joint states.">Finger</a> kinematics handler. <br /></td></tr>
<tr class="separator:adee0025a48211ddc9040329deb7e2cce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a872eb72dc091dfc922f3461989909363" id="r_a872eb72dc091dfc922f3461989909363"><td class="memItemLeft" align="right" valign="top"><a id="a872eb72dc091dfc922f3461989909363" name="a872eb72dc091dfc922f3461989909363"></a>
<a class="el" href="classController.html">Controller</a>&#160;</td><td class="memItemRight" valign="bottom"><b>controller</b></td></tr>
<tr class="memdesc:a872eb72dc091dfc922f3461989909363"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classController.html" title="Provides torque control functionality using a PID algorithm.">Controller</a> for torque control. <br /></td></tr>
<tr class="separator:a872eb72dc091dfc922f3461989909363"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a147b8003a5567f680edf4838fa5b4972" id="r_a147b8003a5567f680edf4838fa5b4972"><td class="memItemLeft" align="right" valign="top"><a id="a147b8003a5567f680edf4838fa5b4972" name="a147b8003a5567f680edf4838fa5b4972"></a>
float *&#160;</td><td class="memItemRight" valign="bottom"><b>joint_states</b></td></tr>
<tr class="memdesc:a147b8003a5567f680edf4838fa5b4972"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to the current joint states. <br /></td></tr>
<tr class="separator:a147b8003a5567f680edf4838fa5b4972"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dcd474047ac30b63b6203f7c616d87d" id="r_a6dcd474047ac30b63b6203f7c616d87d"><td class="memItemLeft" align="right" valign="top"><a id="a6dcd474047ac30b63b6203f7c616d87d" name="a6dcd474047ac30b63b6203f7c616d87d"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>motor_offsets</b> [4] = {0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:a6dcd474047ac30b63b6203f7c616d87d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Offsets for motor positions. <br /></td></tr>
<tr class="separator:a6dcd474047ac30b63b6203f7c616d87d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e0bf4dcd86c3fc4661fc2f75dbf0054" id="r_a4e0bf4dcd86c3fc4661fc2f75dbf0054"><td class="memItemLeft" align="right" valign="top"><a id="a4e0bf4dcd86c3fc4661fc2f75dbf0054" name="a4e0bf4dcd86c3fc4661fc2f75dbf0054"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>print</b> [2] = {0.0, 0.0}</td></tr>
<tr class="memdesc:a4e0bf4dcd86c3fc4661fc2f75dbf0054"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array used for serial feedback (positions). <br /></td></tr>
<tr class="separator:a4e0bf4dcd86c3fc4661fc2f75dbf0054"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a650a863e2f7800182a4f1c9f73b29f69" id="r_a650a863e2f7800182a4f1c9f73b29f69"><td class="memItemLeft" align="right" valign="top"><a id="a650a863e2f7800182a4f1c9f73b29f69" name="a650a863e2f7800182a4f1c9f73b29f69"></a>
float *&#160;</td><td class="memItemRight" valign="bottom"><b>joint_commands</b></td></tr>
<tr class="memdesc:a650a863e2f7800182a4f1c9f73b29f69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to decoded joint command values. <br /></td></tr>
<tr class="separator:a650a863e2f7800182a4f1c9f73b29f69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ebd040882873f33ba4ca79846ecd37b" id="r_a3ebd040882873f33ba4ca79846ecd37b"><td class="memItemLeft" align="right" valign="top"><a id="a3ebd040882873f33ba4ca79846ecd37b" name="a3ebd040882873f33ba4ca79846ecd37b"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>motor_position_states</b> [4] = {0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:a3ebd040882873f33ba4ca79846ecd37b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current motor position states. <br /></td></tr>
<tr class="separator:a3ebd040882873f33ba4ca79846ecd37b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada5550d3516005d96a11c936ee550114" id="r_ada5550d3516005d96a11c936ee550114"><td class="memItemLeft" align="right" valign="top"><a id="ada5550d3516005d96a11c936ee550114" name="ada5550d3516005d96a11c936ee550114"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>motor_velocity_states</b> [4] = {0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:ada5550d3516005d96a11c936ee550114"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current motor velocity states. <br /></td></tr>
<tr class="separator:ada5550d3516005d96a11c936ee550114"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae555d77b5a5f0935e5ee63b6d2a6a191" id="r_ae555d77b5a5f0935e5ee63b6d2a6a191"><td class="memItemLeft" align="right" valign="top"><a id="ae555d77b5a5f0935e5ee63b6d2a6a191" name="ae555d77b5a5f0935e5ee63b6d2a6a191"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>motor_position_offsets</b> [4] = {0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:ae555d77b5a5f0935e5ee63b6d2a6a191"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibration offsets for motor positions. <br /></td></tr>
<tr class="separator:ae555d77b5a5f0935e5ee63b6d2a6a191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a682d64c640e8b618b1e305c56f7c099a" id="r_a682d64c640e8b618b1e305c56f7c099a"><td class="memItemLeft" align="right" valign="top"><a id="a682d64c640e8b618b1e305c56f7c099a" name="a682d64c640e8b618b1e305c56f7c099a"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>joint_targets</b> [2] = {0.0, 0.0}</td></tr>
<tr class="memdesc:a682d64c640e8b618b1e305c56f7c099a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Desired joint targets. <br /></td></tr>
<tr class="separator:a682d64c640e8b618b1e305c56f7c099a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1b3af4cc560a77793b48b8e544f380d" id="r_ad1b3af4cc560a77793b48b8e544f380d"><td class="memItemLeft" align="right" valign="top"><a id="ad1b3af4cc560a77793b48b8e544f380d" name="ad1b3af4cc560a77793b48b8e544f380d"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>static_torque</b> = 0.065</td></tr>
<tr class="memdesc:ad1b3af4cc560a77793b48b8e544f380d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Static torque used during calibration. <br /></td></tr>
<tr class="separator:ad1b3af4cc560a77793b48b8e544f380d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5c20b3a568c8f616ca560e3db173396" id="r_af5c20b3a568c8f616ca560e3db173396"><td class="memItemLeft" align="right" valign="top"><a id="af5c20b3a568c8f616ca560e3db173396" name="af5c20b3a568c8f616ca560e3db173396"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>velocity_limit</b> = 50.0</td></tr>
<tr class="memdesc:af5c20b3a568c8f616ca560e3db173396"><td class="mdescLeft">&#160;</td><td class="mdescRight">Velocity limit for safety. <br /></td></tr>
<tr class="separator:af5c20b3a568c8f616ca560e3db173396"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18358243788f8a956ff50db015724a56" id="r_a18358243788f8a956ff50db015724a56"><td class="memItemLeft" align="right" valign="top"><a id="a18358243788f8a956ff50db015724a56" name="a18358243788f8a956ff50db015724a56"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>calibrated</b> = false</td></tr>
<tr class="memdesc:a18358243788f8a956ff50db015724a56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag indicating whether calibration is complete. <br /></td></tr>
<tr class="separator:a18358243788f8a956ff50db015724a56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5fc2c067a5d275ec1d6f4eed478b335" id="r_ad5fc2c067a5d275ec1d6f4eed478b335"><td class="memItemLeft" align="right" valign="top"><a id="ad5fc2c067a5d275ec1d6f4eed478b335" name="ad5fc2c067a5d275ec1d6f4eed478b335"></a>
std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>motor_states</b> = {0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:ad5fc2c067a5d275ec1d6f4eed478b335"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current motor positions (std::vector format). <br /></td></tr>
<tr class="separator:ad5fc2c067a5d275ec1d6f4eed478b335"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8f141b772f50e494bf0c2ca59d8f308" id="r_ab8f141b772f50e494bf0c2ca59d8f308"><td class="memItemLeft" align="right" valign="top"><a id="ab8f141b772f50e494bf0c2ca59d8f308" name="ab8f141b772f50e494bf0c2ca59d8f308"></a>
std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>motor_torques</b> = {0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:ab8f141b772f50e494bf0c2ca59d8f308"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computed motor torques. <br /></td></tr>
<tr class="separator:ab8f141b772f50e494bf0c2ca59d8f308"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3d50d72d4c17514499781eda97e99cb" id="r_aa3d50d72d4c17514499781eda97e99cb"><td class="memItemLeft" align="right" valign="top"><a id="aa3d50d72d4c17514499781eda97e99cb" name="aa3d50d72d4c17514499781eda97e99cb"></a>
std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>joint_error_sum</b> = {0.0, 0.0}</td></tr>
<tr class="memdesc:aa3d50d72d4c17514499781eda97e99cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accumulated joint error sum. <br /></td></tr>
<tr class="separator:aa3d50d72d4c17514499781eda97e99cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d15cb77cbe6fd6e64a2f1f0d6af33db" id="r_a9d15cb77cbe6fd6e64a2f1f0d6af33db"><td class="memItemLeft" align="right" valign="top"><a id="a9d15cb77cbe6fd6e64a2f1f0d6af33db" name="a9d15cb77cbe6fd6e64a2f1f0d6af33db"></a>
std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>joint_states_desired</b> = {0.0, 0.0}</td></tr>
<tr class="memdesc:a9d15cb77cbe6fd6e64a2f1f0d6af33db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Desired joint states. <br /></td></tr>
<tr class="separator:a9d15cb77cbe6fd6e64a2f1f0d6af33db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f670be4d519d72bc5e530303037b7e9" id="r_a9f670be4d519d72bc5e530303037b7e9"><td class="memItemLeft" align="right" valign="top"><a id="a9f670be4d519d72bc5e530303037b7e9" name="a9f670be4d519d72bc5e530303037b7e9"></a>
std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>motor_velocities</b> = {0.0, 0.0, 0.0, 0.0}</td></tr>
<tr class="memdesc:a9f670be4d519d72bc5e530303037b7e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current motor velocities. <br /></td></tr>
<tr class="separator:a9f670be4d519d72bc5e530303037b7e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a021141e4ed340d853a361edbafdc68a8" id="r_a021141e4ed340d853a361edbafdc68a8"><td class="memItemLeft" align="right" valign="top"><a id="a021141e4ed340d853a361edbafdc68a8" name="a021141e4ed340d853a361edbafdc68a8"></a>
uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><b>packet</b></td></tr>
<tr class="memdesc:a021141e4ed340d853a361edbafdc68a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer to a serial packet. <br /></td></tr>
<tr class="separator:a021141e4ed340d853a361edbafdc68a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a2bc0c52048720b86d3ac3757be2a74" id="r_a0a2bc0c52048720b86d3ac3757be2a74"><td class="memItemLeft" align="right" valign="top"><a id="a0a2bc0c52048720b86d3ac3757be2a74" name="a0a2bc0c52048720b86d3ac3757be2a74"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>danger_mode</b> = false</td></tr>
<tr class="memdesc:a0a2bc0c52048720b86d3ac3757be2a74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag indicating if danger mode is active. <br /></td></tr>
<tr class="separator:a0a2bc0c52048720b86d3ac3757be2a74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa391c452d54cd2a2548594f45550614e" id="r_aa391c452d54cd2a2548594f45550614e"><td class="memItemLeft" align="right" valign="top"><a id="aa391c452d54cd2a2548594f45550614e" name="aa391c452d54cd2a2548594f45550614e"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>received_joint_commands</b> = false</td></tr>
<tr class="memdesc:aa391c452d54cd2a2548594f45550614e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag indicating if valid joint commands were received. <br /></td></tr>
<tr class="separator:aa391c452d54cd2a2548594f45550614e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59918f61772470adeabda7051b0989aa" id="r_a59918f61772470adeabda7051b0989aa"><td class="memItemLeft" align="right" valign="top"><a id="a59918f61772470adeabda7051b0989aa" name="a59918f61772470adeabda7051b0989aa"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>j1_input</b> = 0.0</td></tr>
<tr class="memdesc:a59918f61772470adeabda7051b0989aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Raw input for joint 1. <br /></td></tr>
<tr class="separator:a59918f61772470adeabda7051b0989aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53d34378b2db9479f9639971a3af17ae" id="r_a53d34378b2db9479f9639971a3af17ae"><td class="memItemLeft" align="right" valign="top"><a id="a53d34378b2db9479f9639971a3af17ae" name="a53d34378b2db9479f9639971a3af17ae"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>j2_input</b> = 0.0</td></tr>
<tr class="memdesc:a53d34378b2db9479f9639971a3af17ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Raw input for joint 2. <br /></td></tr>
<tr class="separator:a53d34378b2db9479f9639971a3af17ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a611fecda0f687436671e9851b92e192e" id="r_a611fecda0f687436671e9851b92e192e"><td class="memItemLeft" align="right" valign="top"><a id="a611fecda0f687436671e9851b92e192e" name="a611fecda0f687436671e9851b92e192e"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>motor1_torque_cmd</b> = r1806_protocols.encodeTorqueCommand(1, 0.0)</td></tr>
<tr class="separator:a611fecda0f687436671e9851b92e192e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b18957b3169fc2992425d6488c08afc" id="r_a9b18957b3169fc2992425d6488c08afc"><td class="memItemLeft" align="right" valign="top"><a id="a9b18957b3169fc2992425d6488c08afc" name="a9b18957b3169fc2992425d6488c08afc"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>motor1_close_loop_request_cmd</b> = r1806_protocols.encodeRequestedStateCommand(1, <a class="el" href="motor__protocols_2utils_8h.html#a15ee4d274ebbd72a00d1184e3aca0df2">ODrive.Axis.AxisState.CLOSED_LOOP_CONTROL</a>)</td></tr>
<tr class="separator:a9b18957b3169fc2992425d6488c08afc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a757e1bd96b23c795f03d7ff02112c52b" id="r_a757e1bd96b23c795f03d7ff02112c52b"><td class="memItemLeft" align="right" valign="top"><a id="a757e1bd96b23c795f03d7ff02112c52b" name="a757e1bd96b23c795f03d7ff02112c52b"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>motor2_torque_cmd</b> = r1806_protocols.encodeTorqueCommand(1, 0.0)</td></tr>
<tr class="separator:a757e1bd96b23c795f03d7ff02112c52b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acde79ade2105ba5a318746769e4b75b4" id="r_acde79ade2105ba5a318746769e4b75b4"><td class="memItemLeft" align="right" valign="top"><a id="acde79ade2105ba5a318746769e4b75b4" name="acde79ade2105ba5a318746769e4b75b4"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>motor2_close_loop_request_cmd</b> = r1806_protocols.encodeRequestedStateCommand(2, <a class="el" href="motor__protocols_2utils_8h.html#a15ee4d274ebbd72a00d1184e3aca0df2">ODrive.Axis.AxisState.CLOSED_LOOP_CONTROL</a>)</td></tr>
<tr class="separator:acde79ade2105ba5a318746769e4b75b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92903169297b3ab5289d4dc72b170352" id="r_a92903169297b3ab5289d4dc72b170352"><td class="memItemLeft" align="right" valign="top"><a id="a92903169297b3ab5289d4dc72b170352" name="a92903169297b3ab5289d4dc72b170352"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>motor3_torque_cmd</b> = r1806_protocols.encodeTorqueCommand(1, 0.0)</td></tr>
<tr class="separator:a92903169297b3ab5289d4dc72b170352"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a566764c298010102b2468c64afb68ec9" id="r_a566764c298010102b2468c64afb68ec9"><td class="memItemLeft" align="right" valign="top"><a id="a566764c298010102b2468c64afb68ec9" name="a566764c298010102b2468c64afb68ec9"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>motor3_close_loop_request_cmd</b> = r1806_protocols.encodeRequestedStateCommand(3, <a class="el" href="motor__protocols_2utils_8h.html#a15ee4d274ebbd72a00d1184e3aca0df2">ODrive.Axis.AxisState.CLOSED_LOOP_CONTROL</a>)</td></tr>
<tr class="separator:a566764c298010102b2468c64afb68ec9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8713dccb56c13753e3dcbd40557f8b38" id="r_a8713dccb56c13753e3dcbd40557f8b38"><td class="memItemLeft" align="right" valign="top"><a id="a8713dccb56c13753e3dcbd40557f8b38" name="a8713dccb56c13753e3dcbd40557f8b38"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>motor4_torque_cmd</b> = r1806_protocols.encodeTorqueCommand(1, 0.0)</td></tr>
<tr class="separator:a8713dccb56c13753e3dcbd40557f8b38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bd6510e1a4c11d79832fc41619bcdd6" id="r_a1bd6510e1a4c11d79832fc41619bcdd6"><td class="memItemLeft" align="right" valign="top"><a id="a1bd6510e1a4c11d79832fc41619bcdd6" name="a1bd6510e1a4c11d79832fc41619bcdd6"></a>
CAN_message_t&#160;</td><td class="memItemRight" valign="bottom"><b>motor4_close_loop_request_cmd</b> = r1806_protocols.encodeRequestedStateCommand(4, <a class="el" href="motor__protocols_2utils_8h.html#a15ee4d274ebbd72a00d1184e3aca0df2">ODrive.Axis.AxisState.CLOSED_LOOP_CONTROL</a>)</td></tr>
<tr class="separator:a1bd6510e1a4c11d79832fc41619bcdd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a698746f2c571003e99bc70c3730e2276" id="r_a698746f2c571003e99bc70c3730e2276"><td class="memItemLeft" align="right" valign="top"><a id="a698746f2c571003e99bc70c3730e2276" name="a698746f2c571003e99bc70c3730e2276"></a>
const uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>POSITION_TIMEOUT_MS</b> = 100</td></tr>
<tr class="memdesc:a698746f2c571003e99bc70c3730e2276"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum allowed delay for receiving joint commands. <br /></td></tr>
<tr class="separator:a698746f2c571003e99bc70c3730e2276"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8362cdf9289c711a7450ad930a6304b9" id="r_a8362cdf9289c711a7450ad930a6304b9"><td class="memItemLeft" align="right" valign="top"><a id="a8362cdf9289c711a7450ad930a6304b9" name="a8362cdf9289c711a7450ad930a6304b9"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>lastpositionCmdTime</b> = millis()</td></tr>
<tr class="memdesc:a8362cdf9289c711a7450ad930a6304b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestamp of the last valid joint command received. <br /></td></tr>
<tr class="separator:a8362cdf9289c711a7450ad930a6304b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Main entry point for the motor control and serial feedback system. </p>
<p>This file sets up CAN communication, motor and serial protocols, and implements the main control loop. It integrates functionalities from various modules such as motor protocols (<a class="el" href="classR1806.html" title="Provides methods to encode and decode CAN messages for controlling an R1806 motor via ODrive.">R1806</a>), serial protocols, finger kinematics, and a <a class="el" href="classController.html" title="Provides torque control functionality using a PID algorithm.">Controller</a> for torque control. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad4a7316a51b17d0f691bb3e33b95a5ad" name="ad4a7316a51b17d0f691bb3e33b95a5ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4a7316a51b17d0f691bb3e33b95a5ad">&#9670;&#160;</a></span>calibrate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calibrate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calibrates motor position offsets. </p>
<p>Sends a static torque command for a short duration to settle the system, then records the current motor positions as offsets. After calibration, the system adjusts subsequent motor position readings. </p>

</div>
</div>
<a id="a8b5e6477c003c4cbfb7cf9ba724fce34" name="a8b5e6477c003c4cbfb7cf9ba724fce34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b5e6477c003c4cbfb7cf9ba724fce34">&#9670;&#160;</a></span>canSniff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void canSniff </td>
          <td>(</td>
          <td class="paramtype">const CAN_message_t &amp;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function for received CAN messages. </p>
<p>This function processes incoming CAN messages by extracting the motor ID and command ID, updating motor position and velocity states, and applying calibration offsets when needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The received CAN message. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afe461d27b9c48d5921c00d521181f12f" name="afe461d27b9c48d5921c00d521181f12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe461d27b9c48d5921c00d521181f12f">&#9670;&#160;</a></span>loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main control loop. </p>
<p>Processes incoming CAN messages and serial commands, performs torque control using a PID controller, updates joint states, checks safety conditions (e.g., velocity limits), and sends feedback packets over Serial. </p>

</div>
</div>
<a id="a7dfd9b79bc5a37d7df40207afbc5431f" name="a7dfd9b79bc5a37d7df40207afbc5431f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7dfd9b79bc5a37d7df40207afbc5431f">&#9670;&#160;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the system. </p>
<p>Sets up Serial communication, configures the CAN bus (baud rate, RX/TX pins, FIFO, etc.), registers the CAN receive callback, sends closed-loop control requests, and initiates calibration. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
